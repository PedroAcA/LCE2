clear all;
function j = proxima_janela(v,indice_atual,tamanho_janela)
  for i = 1:tamanho_janela
    j(i) = v(indice_atual+i-1);
  end
end
function f = bpm(amostras,taxa_amostragem)%gera a freqeuncia em batimentos por minuto (bpm)
  maximo = max(amostras);
  margem = 0.2;
  tam = length(amostras);
  pulsos = 0;
  base = 600;%threshold
  if maximo >=base
    %if mod(tam,3) == 0
    % tam_janela = 15; 
    %else  
    % tam_janela = 20;
    %end
    tam_janela = 5;%como escolher o tamanho da janela de forma adequada?
    for ind = 1:tam_janela:tam
     janela = proxima_janela(amostras,ind,tam_janela);
      maximo_local = max(janela);
      if (maximo_local>=base*(1-margem) ) && (maximo_local <= base*(1+margem) ) 
        pulsos = pulsos + 1;
      end 
    end 
  end
  if pulsos > 0
    f = (60*1000)/( (tam/pulsos)*taxa_amostragem );
  else
    f = 0;
  end 
end 

%lados opostos protoboard
v=[590,583,291,346,156,165,173,166,199,158,282,169,384,278,238,150,155,134,366,387,274,165,155,157,155,160,162,163,161,162,162,163,160,153,149,159,172,159,374,287,363,262,254,179,312,248,202,158,237,445,244,143,139,315,670,350,175,172,169,173,203,273,236,168,156,82,145,150,144,309,349,162,160,152,154,183,289,142,165,166,189,494,667,665,662,159,160,148,145,163,153,251,344,346,214,177,179,171,158,154,147,159,181,370,199,141,584,660,136,345,134,137,138,140,151,146,155,168,161,175,376,340,655,342,144,151,158,151,153,148,142,181,387,163,166,151,157,145,177,173,176,160,153,157,150,150,150,151,185,294,194,269,265,256,196,202,238,286,324,315,355,390,502,524,524,519,507,502,534,405,507,524,546,512,566,554,403,399,380,388,343,383,403,307,179,183,184,191,203,183,185,186,188,265,330,356,368,547,572,262];
plot(v);
print("v.png");
freq_v = bpm(v,50)
v1 = [249,171,165,199,203,319,238,189,238,515,475,151,183,185,191,184,232,195,211,203,200,178,182,193,195,179,189,199,191,191,182,188,193,203,207,201,205,209,206,209,217,312,273,214,215,211,210,202,202,193,199,201,205,202,203,204,204,197,198,196,200,198,201,207,225,247,273,283,271,269,266,218,207,209,206,216,253,293,289,286,257,220,226,215,215,220,211,211,207,203,200,200,198,197,196,195,187,187,185,185];
plot(v1);
print("v1.png");
freq_v1 = bpm(v1,50)

v2 = [453,158,211,198,195,188,580,275,313,193,436,605,273,147,148,132,121,170,159,171,157,160,168,172,172,171,174,174,170,164,158,151,149,151,156,158,156,160,157,156,154,152,151,151,151,154,153,152,153,152,153,151,150,151,151,150,148,146,145,144,144,143,143,143,142,143,145,145,143,141,145,146,146,149,148,148,148,148,147,147,146,147,147,146,146,146,146,146,146,146,147,146,147,147,147,146,147,146,146,145];
plot(v2);
print("v2.png");
freq_v2 = bpm(v2,50)
%virados um pro outro
v3 = [179,186,173,177,190,185,183,183,182,182,182,182,182,181,181,180,179,180,179,180,180,179,178,178,176,167,183,179,177,178,183,187,190,193,192,195,191,187,187,187,187,185,185,185,184,183,182,186,184,187,187,187,187,187,188,191,193,196,197,196,195,194,195,199,202,200,201,201,201,201,201,202,204,186,187,188,196,195,197,197,200,202,197,195,195,195,192,191,189,189,192,195,191,190,192,193,193,193,192,193];
plot(v3);
print("v3.png");
freq_v3 = bpm(v3,50)

v4 = [391,676,683,682,638,652,608,145,161,194,138,156,141,165,128,130,132,134,132,140,138,142,142,143,143,141,140,141,140,139,139,137,136,135,135,136,135,135,136,136,136,136,135,134,134,134,134,134,133,133,133,133,133,132,132,132,133,132,132,131,131,131,130,130,129,130,129,131,131,131,131,131,131,130,129,129,128,129,150,131,134,137,142,144,146,144,146,145,145,144,143,142,141,140,139,139,139,138,139,139];
plot(v4);
print("v4.png");
freq_v4 = bpm(v4,50)

%mesmo lado protoboard
v5 = [128,132,656,124,126,127,127,126,126,126,126,126,126,126,126,126,125,127,125,125,126,126,126,126,126,125,126,125,126,125,124,125,125,124,124,124,125,124,124,125,125,125,124,125,125,126,126,126,126,126,125,125,125,125,124,124,124,125,125,142,145,149,150,150,152,153,155,161,164,215,259,285,337,658,657,658,649,590,524,466,414,368,331,300,274,249,229,212,197,196,129,139,178,217,439,581,607,290,168,155];
plot(v5);
print("v5.png");
freq_v5 = bpm(v5,50)

%sem desconectar o fio da porta digital e mesmo lado protoboard


v6 = [174,173,174,174,173,163,159,159,160,159,159,158,158,158,158,159,158,158,157,159,160,161,152,233,194,192,192,191,193,234,295,303,303,317,315,281,336,423,593,378,345,359,359,354,356,365,480,445,435,425,418,408,394,388,385,381,595,563,541,616,580,490,407,386,388,375,365,365,357,370,372,350,338,354,356,356,358,360,360,360,361,361,362,364,361,373,373,371,367,363,360,358,359,360,354,349,347,345,345,345];
plot(v6);
print("v6.png");
freq_v6 = bpm(v6,50)

v7 = [180,171,163,168,144,137,126,127,127,136,215,173,138,121,288,379,378,129,128,102,350,103,115,113,129,245,403,399,371,329,295,268,245,226,210,195,174,166,158,153,148,142,138,135,133,136,134,131,129,127,125,123,120,119,118,117,117,116,115,114,114,113,112,113,112,112,111,111,110,110,109,109,108,105,105,105,105,105,106,106,105,105,106,106,106,105,106,106,106,106,107,108,107,108,107,106,106,103,103,104,103,104,104,104,104,105,104,104,104,103,103,104,104,103,103,104,102,102,104,108,108,116,140,659,645,645,199,196,177,189,128,142,145,141,132,131,131,127,156,153,146,146,144,144,79,476,510,473,421,376,337,303,274,250,230,215,199,186,172,109,144,155,153,154,147,142,134,128,131,129,127,124,121,120,119,118,117,117,116,121,120,119,117,117,116,116,116,114,114,114,111,110,112,110,112,112,111,110,112,110];
plot(v7);
print("v7.png");
freq_v7 = bpm(v7,50)

v8 = [200,190,178,157,157,156,156,155,156,157,200,180,165,163,157,156,156,156,157,158,157,156,158,157,161,172,154,210,192,188,178,175,151,678,677,677,677,676,652,180,179,177,172,167,165,164,154,402,610,360,155,150,153,153,152,150,150,152,152,153,154,153,152,152,152,152,152,152,152,152,153,152,152,153,152,151,151,150,150,151,150,151,151,150,150,153,155,166,173,171,171,171,171,171,170,171,173,182,160,170,174,176,176,176,176,176,175,175,173,172,172,171,169,165,162,165,174,175,174,173,174,173,163,161,160,156,154,153,155,159,170,170,168,167,167,166,165,165,165,164,164,163,172,172,173,174,173,172,172,173,172,171,166,169,170,154,153,152,151,151,150,150,150,151,151,152,153,155,153,149,208,159,159,160,172,168,158,154,150,150,149,150,153,158,154,151,149,152,155,151,153,156,157,154,155,155,154,153,152,152];
plot(v8);
print("v8.png");
freq_v8 = bpm(v8,50)

v9 = [322,248,261,352,412,286,315,551,409,284,368,317,672,671,672,671,667,668,654,667,511,669,670,484,299,281,289,284,281,280,276,277,282,284,294,295,455,654,668,579,550,540,438,351,469,653,520,541,343,405,316,249,248,250,282,321,275,290,278,271,261,255,256,264,279,318,455,411,367,349,312,296,269,266,280,259,254,252,252,251,273,262,242,231,227,255,287,261,292,314,312,321,357,335,296,303,317,672,672,454,315,291,288,297,297,304,356,355,362,336,329,331,319,375,302,249,244,241,239,239,239,247,245,269,295,269,267,259,252,254,257,265,279,287,315,335,231,235,238,228,215,212,211,207,214,224,221,228,217,239,224,223,226,487,582,498,438,557,577,515,428,512,514,446,274,249,239,223,221,220,227,228,232,219,190,206,214,303,415,414,366,298,269,217,216,251,230,223,218,218,227,283,289,210,210,210,210,210,209,209,210,206,205,204,204,203,203,203,204,207,207,210,209,209,216,218,215,232,236,233,224,210,243,399,461,464,338,249,224,213,289,206,201,196,270,254,265,271,265,258,261,261,260,257,220,241,241,236,241,234,222,210,210,208,205,205,203,231,210,207,206,204,215,225,227,243,233,232,221,197,194,189,201,199,196,198,207,262,274,291,279,304,301,290,280,267,229,289,296,362,282,269,516,291,212,229,216,239,272,290,269,317,488,433,436,449,404,316,299,336,313,172,177,168,169,170,168,172,177,184,187,188,188,212,246,241,197,194,198,196,195,194,197,198,200,198,199,200,197,197,197,198,195,190,189,187,187,186,185,185,183,184,187,187,187,186,186,186,182,181,180,179,181,179,179,186,198,207,208,209,208,204,198,182,179,178,179,178,179,180,178,178,178,179,179,178,179,180,184,184,183,179,179,178,179,179,179,179,179,179];
plot(v9);
print("v9.png");
freq_v9 = bpm(v9,50)

v10 = [236,223,232,221,238,251,247,264,215,247,307,270,247,219,233,218,281,274,253,272,263,279,242,228,225,220,229,246,249,202,219,200,193,192,166,162,229,190,203,217,230,219,231,242,215,202,184,184,196,200,219,295,266,183,176,223,332,216,186,184,185,183,198,216,197,222,272,272,233,202,204,204,209,215,219,220,186,174,158,158,159,170,340,260,254,170,160,151,269,457,475,455,332,302,314,353,377,401,355,301,247,229,229,235,258,258,283,247,230,260,265,227,202,204,206,197,191,191,214,286,187,202,186,227,223,222,239,207,203,201,203,202,202,200,199,198,201,202,204,209,231,296,294,280,257,227,218,216,216,201,190,225,207,261,280,221,204,177,186,195,181,162,161,155,179,183,185,193,193,214,207,206,221,216,215,229,231,207,207,173,213,190,195,193,210,199,200,206,194,213,181,170,175,187,176,172,179,186,198,174,173,172,165,166,174,170,186,194,183,183,171,177,171,170,174,181,185,213,185,172,573,689,261,548,692,691,690,690,660,206,494,521,497,193,177,368,448,435,402,184,197,190,185,163,174,180,182,185,180,178,180,180,181,178,184,185,189,186,185,186,179,177,181,182,180,176,179,181,185,183,177,175,181,179,176,175,169,163,160,160,157,165,174,174,175,186,185,188,186,184,183,183,183,184,183,178,183,188,190,188,187,187,197,205,204,208,205,204,205,209,218,222,226,265,187,183,195,190,186,182,182,188,191,187,187,184,193,194,187,186,187,185,185,188,193,192,191,189,198,196,196,198,197,195,197,193,187,190,186,187,184,180,165,162,159,156,156,160,159,160,160,161,162,168,172,179,184,186,185,186,183,179,172,183,180,183,184,175,175,171,178,177,173,164,167,168,167,163,163,162,163,163,162,163,163,162,162,160,160,163];
plot(v10);
print("v10.png");
freq_v10 = bpm(v10,50)

v11 = [152,153,152,152,154,242,295,311,532,659,467,163,143,145,144,140,143,174,143,142,142,142,143,144,143,144,150,153,179,620,176,158,160,160,159,159,161,165,162,163,163,163,163,163,164,164,164,164,165,164,163,164,164,165,165,166,165,166,165,165,169,174,165,208,177,289,168,169,322,303,284,305,321,328,338,342,389,301,406,395,522,664,634,619,637,372,640,576,644,500,644,652,652,497,639,652,652,650,466,168,174,176,215,402,486,631,655,655,654,653,652,654,655,620,654,653,654,654,655,654,654,654,565,640,612,255,176,163,152,660,286,161,643,633,453,242,453,330,170,204,209,162,164,163,163,164,157,149,148,148,149,149,149,149,148,148,149,149,150,149,144,145,145,145,146,146,146,146,146,146,147,147,147,148,150,150,151,152,153,153,152,154,155,155,154,154,155,154,153,153,154,153,153,154,155,154,154,150,150,0];%ultimo valor nao pode ser registrado
plot(v11);
print("v11.png");
freq_v11 = bpm(v11,50)

%17//06/17:
v12 = [150,146,184,553,684,655,107,431,238,472,479,445,168,151,116,150,51,416,449,360,419,132,150,145,355,332,397,385,67,293,324,305,285,263,246,224,216,210,208,153,156,187,184,193,129,190,184,192,179,195,129,183,180,166,170,165,179,141,168,169,167,160,168,174,84,685,686,685,658,596,531,475,425,384,348,318,292,270,251,241,220,141,178,209,205,197,188,173,163,154,152,149,145,147,158,158,154,165,200,217,219,192,176,177,150,175,161,149,146,165,154,101,245,239,231,241,177,167,174,166,169,159,166,219,184,171,147,175,157,183,230,219,195,358,180,199,208,150,164,162,165,164,177,171,172,174,175,168,215,223,235,258,235,195,176,180,193,180,167,171,255,289,263,309,388,444,583,629,658,438,259,420,465,444,405,242,165,163,170,685,686,685,165,170,534,129,165,175,171,164,150,441,183,152,157,159,161,191,180,180];
plot(v12);
print("v12.png");
freq_v12 = bpm(v12,50)


v13 = [179,153,133,174,167,390,538,603,313,609,619,537,448,521,519,226,432,614,620,605,240,223,225,230,263,191,192,193,194,185,175,154,160,184,157,182,184,187,190,196,182,165,141,125,147,191,621,622,620,626,621,608,549,489,435,387,342,307,279,253,231,214,193,143,158,169,588,199,593,373,165,604,271,187,171,180,183,139,141,176,156,213,609,353,170,198,175,190,184,123,201,211,184,163,170,149,163,167,166,165,167,173,199,164,166,167,166,165,183,167,172,146,178,121,180,174,176,173,140,166,160,168,173,193,193,193,200,187,200,155,172,171,110,108,164,184,179,179,148,128,135,140,138,159,135,108,133,135,129,615,627,633,630,637,601,585,534,201,605,596,240,229,200,226,198,183,225,231,235,248,250,598,603,212,182,162,175,158,618,618,616,616,616,614,615,354,421,177,213,198,185,181,179,177,182,178,177,177,194,171];
plot(v13);
print("v13.png");
freq_v13 = bpm(v13,50)

v14 = [160,174,174,176,181,164,171,172,190,162,181,159,141,181,168,147,179,177,142,160,597,653,643,591,543,482,432,391,366,96,296,163,136,147,169,175,197,154,181,187,186,171,213,187,178,178,179,172,152,163,166,632,652,645,591,252,55,182,100,161,182,135,151,190,137,164,106,546,642,186,46,108,159,206,194,190,170,191,168,161,162,182,169,196,192,198,175,188,103,144,403,168,190,186,193,192,184,182,165,192];
plot(v14);
print("v14.png");
freq_v14 = bpm(v14,50)
%v3 = [];
%plot(v3);
%print("v3.png");